写程序最主要的目的是使它在所有可能的情况下都正确工作，速度快但结果错误的程序毫无意义。同时，代码应清晰简洁、可读和易于维护，这不仅对自己更是其他人理解和维护十分友好。

在此基础上，很多情况下，也对程序的性能有要求：
- 对实时任务（视频处理、网络包处理）或长时间计算任务（数日/数周运行的计算）来说，运行速度很重要；
- 小幅度性能提升也可能产生重大影响；
本章将探讨如何使用几种不同类型的程序优化技术，使程序运行得更快。

编写高效程序需要做到以下几点：
- 选择适当的算法与数据结构：
	- 基础且最重要的优化手段；
	- 决定了程序的整体效率上限；
- 编写易于编译器优化以转换成高效可执行代码的源代码：
	- 需要理解编译器的优化能力与限制；
	- 小的源代码写法差异可能导致编译器生成性能大不相同的机器码；
	- 有些编程语言比其他语言容易优化；
- 针对处理运算量特别大的计算，利用并行性，将计算任务拆分在多核或多处理器上并行计算（将在 12 章中讲述，但是每个线程仍需高校执行）；

在程序开发和优化的过程中，必须考虑代码使用的方式，以及影响它的关键因素。通常，程序员必须在实现和维护程序的简单性与它的运行速度之间做出权衡。一个挑战就是尽管做了大量的优化，但还是要维护代码一定程度的简洁和可读性。

关于提高代码性能，理想的情况是，编译器能够接受所编写的任何代码，并产生尽可能高效的、具有指定行为的机器级程序。为此，现代编译器采用了复杂的分析和优化形式，而且变得越来越好。然而，即使是最好的编译器也受到 **妨碍优化的因素（optimization blocker）** 的阻碍，妨碍优化的因素就是程序行为中那些严重依赖于执行环境的方面。程序员必须编写容易优化的代码，以帮助编译器。

<<<<<<< HEAD
**程序优化**：
1. **消除不必要的工作**，让代码尽可能有效地执行所期望的任务 -- 减少函数调用、条件判断和内存引用，这些优化不依赖于目标机器的任何具体属性；
2. **理解目标机器与处理器**
	- 知道了处理器指令时序和执行特性，有助于选择最有实现（如乘法 vs 移位加法组合）；
	- 现代计算机用复杂的技术来处理机器级程序，并行地执行许多指令，执行顺序还可能不同于它们在程序中出现的顺序；
3. **利用指令级并行**，降低数据依赖，增加可并行执行的指令数量；
4. **分析和测量性能**
	- 使用 **代码剖析程序** 测量程序各个部分性能的工具，找出性能瓶颈；
	- 研究程序的汇编代码表示是理解编译器以及产生的代码会如何运行的最有效手段之一，然后再据此修改源代码：
		- 从汇编代码开始，可以预测什么操作会并行执行，以及它们会如何使用处理器资源；
		- 常常通过确认 **关键路径(critical path)** 来决定执行一个循环所需要的时间（或者说，至少是一个时间下界），所谓关键路径是在循环的反复执行过程中形成的数据相关链；
5. **反复试验与源码调整**
	- 通过多次修改源代码，调整编译器生成的机器码性能；
	- 保持代码可读性与可移植性，同时提高效率；
	- 相比直接写汇编，优化源代码能兼顾可读性、模块性和可移植性；

---
